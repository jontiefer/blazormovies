\connect BlazorMovies

CREATE table if not exists public."__EFMigrationsHistory" (
	migrationid varchar(150) NOT NULL,
	productversion varchar(32) NOT NULL,
	CONSTRAINT pk___efmigrationshistory PRIMARY KEY (migrationid)
);

alter table public."__EFMigrationsHistory" owner to jontiefer;

CREATE table if not exists public.genres (
	id int4 NOT NULL GENERATED BY DEFAULT AS identity (START WITH 28 INCREMENT BY 1),
	"name" text NOT NULL,
	CONSTRAINT pk_genres PRIMARY KEY (id)
);

alter table public.genres owner to jontiefer;

CREATE table if not exists public.people (
	id int4 NOT NULL GENERATED BY DEFAULT AS identity (START WITH 7 INCREMENT BY 1),
	"name" text NULL,
	biography text NULL,
	picture text NULL,
	dateofbirth timestamp NOT NULL,
	CONSTRAINT pk_people PRIMARY KEY (id)
);

alter table public.people owner to jontiefer;

CREATE table if not exists public.movies (
	id int4 NOT NULL GENERATED BY DEFAULT AS identity (START WITH 7 INCREMENT BY 1),
	title text NOT NULL,
	summary text NULL,
	intheaters bool NOT NULL,
	trailer text NULL,
	releasedate timestamp NOT NULL,
	poster text NULL,
	CONSTRAINT pk_movies PRIMARY KEY (id)
);

alter table public.movies owner to jontiefer;

CREATE TABLE if not exists public.moviesactors (
	personid int4 NOT NULL,
	movieid int4 NOT NULL,
	"character" text NULL,
	"order" int4 NOT NULL,
	CONSTRAINT pk_moviesactors PRIMARY KEY (movieid, personid)
);
CREATE INDEX ix_moviesactors_personid ON public.moviesactors USING btree (personid);

ALTER TABLE public.moviesactors ADD CONSTRAINT fk_moviesactors_movies_movieid FOREIGN KEY (movieid) REFERENCES movies(id) ON DELETE CASCADE;
ALTER TABLE public.moviesactors ADD CONSTRAINT fk_moviesactors_people_personid FOREIGN KEY (personid) REFERENCES people(id) ON DELETE CASCADE;
alter table public.moviesactors owner to jontiefer;
	 
CREATE table if not exists public.moviesgenres (
	movieid int4 NOT NULL,
	genreid int4 NOT NULL DEFAULT 0,
	CONSTRAINT pk_moviesgenres PRIMARY KEY (movieid, genreid)
);
CREATE INDEX ix_moviesgenres_genreid ON public.moviesgenres USING btree (genreid);

ALTER TABLE public.moviesgenres ADD CONSTRAINT fk_moviesgenres_genres_genreid FOREIGN KEY (genreid) REFERENCES genres(id) ON DELETE CASCADE;
ALTER TABLE public.moviesgenres ADD CONSTRAINT fk_moviesgenres_movies_movieid FOREIGN KEY (movieid) REFERENCES movies(id) ON DELETE CASCADE;
alter table public.moviesgenres owner to jontiefer;
	 	
INSERT INTO public."__EFMigrationsHistory" (migrationid,productversion) VALUES
	 ('20201230045652_Initial','5.0.1'),
	 ('20201230224707_RemoveExtraColumn','5.0.1');

INSERT INTO public.genres (id,"name") VALUES
	 (1,'Comedy'),
	 (3,'Action'),
	 (23,'Crime'),
	 (24,'Horror'),
	 (25,'Science Fiction'),
	 (26,'Documentary'),
	 (27,'Drama');
	
INSERT INTO public.people (id,"name",biography,picture,dateofbirth) values
	 (1,'Tom Holland','This is a biography.','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/actors/TomHolland.jpg','1970-12-15 00:00:00'),
	 (2,'Samuel L. Jackson','Another biography','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/actors/SamuelL.Jackson.jpg','1945-02-04 00:00:00'),
	 (5,'Al Pacino','One of the best actors in the history of modern film.','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/actors/AlPacino.jpg','1942-03-12 00:00:00'),
	 (6,'Andy Garcia','Famous Spanish American actor from The Godfather III','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/actors/AndyGarcia.jpg','1957-03-14 00:00:00');

INSERT INTO public.movies (id,title,summary,intheaters,trailer,releasedate,poster) VALUES
	 (1,'Spider-Man: Far From Home','Great movie',true,'Nt9L1jCKGnE','2020-12-21 00:00:00','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/Spider-Man:FarFromHome.jpg'),
	 (3,'Inception 2','Summary of Inception',false,'8hP9D6kZseM','2021-01-27 00:00:00','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/Inception.jpg'),
	 (5,'Scarface','One of the greatest mafia movies ever.',false,'7pQQHnqBa2E','1983-10-13 00:00:00','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/Scarface.jpg'),
	 (6,'The Godfather IV','The final film of The Godfather saga',false,'iM3KHNu-pUw','2021-05-12 00:00:00','http://yonatan-s3-blazor-course.s3.amazonaws.com/movies/TheGodfatherIV.jpg');

INSERT INTO public.moviesactors (personid,movieid,"character","order") VALUES
	 (1,1,'Peter Parker',1),
	 (2,3,'Character 2',1),
	 (1,3,'Some Dude',2),
	 (5,5,'Tony Montana',1),
	 (6,6,'Vincent Mancini',1);

INSERT INTO public.moviesgenres (movieid,genreid) VALUES
	 (1,3),
	 (1,1),
	 (3,3),
	 (5,3),
	 (5,23),
	 (6,23),
	 (6,27);
